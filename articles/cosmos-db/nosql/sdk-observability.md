---
title: 'Azure Cosmos DB SDK observability'
description: Learn how to monitor requests made using the Azure Cosmos DB SDKs with OpenTelemetry and Application Insights.
author: jcocchi
ms.service: cosmos-db
ms.subservice: nosql
ms.topic: how-to
ms.date: 05/07/2023
ms.author: jucocchi
ms.reviewer: jucocchi
---

# Azure Cosmos DB SDK observability
[!INCLUDE[NoSQL](../includes/appliesto-nosql.md)]

The Azure Cosmos DB .NET and Java SDKs support distributed tracing to help you monitor your applications. Tracing the flow of requests is helpful in debugging, analyzing latency and performance, as well as gathering diagnostics. Instrument tracing for your applications using [OpenTelemetry](https://opentelemetry.io/) which is vendor-neutral and has a set of semantic conventions to ensure a standardized data format regardless of your chosen exporter, or use the [Application Insights SDK](../../azure-monitor/app/app-insights-overview.md#how-do-i-use-application-insights).

## Getting started

Distributed tracing is available in the following SDKs:

|SDK |Supported version |Notes |
|----|------------------|------|
|.NET v3 SDK |[>= `3.33.0-preview`](https://www.nuget.org/packages/Microsoft.Azure.Cosmos/3.33.0-preview) |This feature is on by default if you are using a supported SDK version. You can disable tracing by setting `IsDistributedTracingEnabled = false` in `CosmosClientOptions`. |
|Java v4 SDK |[>= `4.43.0`](https://mvnrepository.com/artifact/com.azure/azure-cosmos/4.43.0) | |

## Trace attributes

Azure Cosmos DB traces follow the [OpenTelemetry database specification](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/semantic_conventions/database.md) and also provide several custom attributes.

|Attribute |Type |Description |
|----------|-----|------------|
| `net.peer.name` | string | Azure Cosmos DB host name. |
| `db.name` | string | Azure Cosmos DB database name. |
| `db.cosmosdb.container` | string | Azure Cosmos DB container name. |
| `db.cosmosdb.client_id` | string | Random GUID representing a unique client instance. |
| `db.cosmosdb.operation_type` | string | Operation type. |
| `db.cosmosdb.connection_mode` | string | Client connection mode. Either `direct` or `gateway`. |
| `db.cosmosdb.status_code` | int | Status code for the request. |
| `db.cosmosdb.sub_status_code` | int | Sub status code for the request. | 
| `db.cosmosdb.request_charge` | double | RUs consumed for the operation. |
| `user_agent.original` | string | Full user-agent string generated by the Azure Cosmos DB SDK. |

Refer to the [Azure Cosmos DB custom attributes](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/semantic_conventions/database.md#microsoft-azure-cosmos-db-attributes) for more information.

### Gather diagnostics

If you have configured logs in your trace provider, you will also get [diagnostics](./troubleshoot-dotnet-sdk.md#capture-diagnostics) for high latency Azure Cosmos DB requests. Point operations that take over 100ms and query operations that take over 500ms will automatically generate diagnostics logs to help you diagnose slow requests without needing custom code.

## Configure OpenTelemetry

To use OpenTelemetry with the Azure Cosmos DB SDKs, add the `Azure.Cosmos.Operation` source to your trace provider. OpenTelemetry is compatible with many exporters that can ingest your data. The following is a sample using the `Azure Monitor OpenTelemetry Exporter`, but you can choose to configure any exporter you wish. See the [complete .NET sample](https://github.com/Azure/azure-cosmos-dotnet-v3/tree/master/Microsoft.Azure.Cosmos.Samples/Usage/OpenTelemetry) on GitHub.

> [!NOTE]
> If you use the `Azure.Monitor.OpenTelemetry.Exporter` package, ensure you are using version >= `1.0.0-beta11`.

[!code-csharp[Main](~/azure-cosmos-dotnet-v3/Microsoft.Azure.Cosmos.Samples/Usage/OpenTelemetry/Program.cs?name=SetUpOpenTelemetry)]

## Configure the Application Insights SDK

There are many different ways to configure Application Insights depending on the language your application is written in and your compute environment. See the [Application Insights documentation](../../azure-monitor/app/app-insights-overview.md#how-do-i-use-application-insights) for more information.

The following is an example of how to configure Application Insights for a console app. See the [complete .NET sample](https://github.com/Azure/azure-cosmos-dotnet-v3/tree/master/Microsoft.Azure.Cosmos.Samples/Usage/OpenTelemetry) on GitHub.

> [!NOTE]
> Use version >= `2.22.0-beta2` of the Application Insights package for your target .NET environment.

[!code-csharp[Main](~/azure-cosmos-dotnet-v3/Microsoft.Azure.Cosmos.Samples/Usage/ApplicationInsights/Program.cs?name=SetUpApplicationInsights)]

Once trace data is ingested into Application Insights, you will be able to visualize it in the Azure portal to understand the request flow in your application. Here's an example of trace data from a cross partition query in the transaction search blade of the Azure portal.

:::image type="content" source="./media/sdk-observability/appInsights-integration.png" alt-text="Distributed tracing of an Azure Cosmos DB cross partition query in the Application Insights transaction search." border="false":::

## Next Steps

- [Get started with the .NET SDK](./quickstart-dotnet.md)
- [Get started with the Java SDK](./quickstart-java.md)
- [Monitor Azure Cosmos DB](../monitor.md)
